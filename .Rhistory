}
}else{
if(length(unique(cellsannot[which(cellsannot$sample_name %in%samplesID) ,]$patient_id))>0){
if(patID==unique(cellsannot[which(cellsannot$sample_name %in%samplesID) ,]$patient_id)){
SamAnnot[paste0(patID,'_head_and_tail'),]$SamplesID = samplesID
}}else{message("none")}
}}
}
unique(SamAnnot$title)
unique(cellsannot$patient_id)
SamAnnot$PatientsID=NA
for (i in unique(cellsannot$patient_id)){
pos=  which(grepl(i,unique(SamAnnot$title)))
if(!is_empty(pos)){
SamAnnot[pos,]$PatientsID = i}
}
SamAnnot[SamAnnot$title=="19-227PancNorm","PatientsID"] = "19227"
SamAnnot[SamAnnot$title=="19-732PancNorm","PatientsID"]= "19732"
SamAnnot[SamAnnot$title=="Donor_6_head","PatientsID"]= "Donor_6"
SamAnnot[SamAnnot$title=="Donor_6_tail","PatientsID"]= "Donor_6"
SamAnnot[SamAnnot$title=="DS20191246Tumor","PatientsID"]= "1246"
SamAnnot[SamAnnot$title=="DS20191238Tumor","PatientsID"]= "1238"
SamAnnot[SamAnnot$title=="DS20191229Tumor","PatientsID"]= "1229"
Metadata <- CreateDataset(project,path) %>%
AddClinicFromObject(object = publishedClinic,
Export = F,
setSamplesID.Column = NULL,
setPatientID.Column = "Donor ID",
name ="rawClinic" ,
type ="Patients") %>%
AddClinicFromObject(object = SamAnnot,
Export = F,
setSamplesID.Column = "SamplesID",
setPatientID.Column = "PatientsID",
name ="RawSamAnnot" ,
type ="Samples") %>%
AddClinicFromObject(object = cellsannot,
Export = F,
setSamplesID.Column = "sample_name",
setCellsBarcode.Column = "barcodes",
setPatientID.Column = "patient_id",
name ="RawCellsAnnot",
type ="Cells") %>%
AddExpressionMatrixSC(
ExpressionMatrix = count,
name = "rawcount")
CheckMeta(Metadata)
unique(cellsannot[which(cellsannot$sample_name %in%samplesID)
)
unique(cellsannot$sample_name)
unique(cellsannot$sample_name) %in% SamAnnot$SamplesID
summary(unique(cellsannot$sample_name) %in% SamAnnot$SamplesID)
summary(unique(cellsannot$patient_id) %in% SamAnnot$PatientsID)
unique(cellsannot$patient_id)
SamAnnot$PatientsID
summary(unique(cellsannot$patient_id) %in% unique(SamAnnot$PatientsID))
unique(cellsannot$patient_id)
unique(cellsannot$sample_name)
"119833" %in% as.matrix(SamAnnot)
"119833" %in%
str_detect(as.matrix(SamAnnot),"119833")
str_detect(as.matrix(publishedClinic),"119833")
"119833" %in%
str_detect(as.matrix(SamAnnot),"119833")
str_detect(as.matrix(publishedClinic),"119833")
as.matrix(SamAnnot)
summary(unique(cellsannot$patient_id) %in% unique(SamAnnot$PatientsID))
unique(SamAnnot$PatientsID)
unique(cellsannot$patient_id)
unique(paste0(cellsannot$patient_id),"_",cellsannot$location)
unique(paste0(cellsannot$patient_id,"_",cellsannot$location))
summary(unique(paste0(cellsannot$patient_id,"_",cellsannot$location)) %in% unique(SamAnnot$title))
unique(paste0(cellsannot$patient_id,"_",cellsannot$location))[unique(paste0(cellsannot$patient_id,"_",cellsannot$location)) %in% unique(SamAnnot$title))]
unique(paste0(cellsannot$patient_id,"_",cellsannot$location))[unique(paste0(cellsannot$patient_id,"_",cellsannot$location)) %in% unique(SamAnnot$title)]
cellsannot$SamplesNewID = paste0(cellsannot$patient_id,"_",cellsannot$location,"_", cellsannot$sample_name)
unique(cellsannot$SamplesNewID)
# looking for samplesID from published clinic and cells annotation to paste into samannot
for (i in 1:9){
patID = publishedClinic[i,]$`Donor ID`
samplesID = unlist(str_split(publishedClinic[i,]$`Sequencing Run`,"; "))
if(!all(is.na(samplesID))){
if(length(samplesID)>1){
for (j in samplesID){
sam =  unlist(str_split(j," "))[2]
loc = unlist(str_split(j," "))[1]
if(length(unique(cellsannot[which(cellsannot$sample_name %in%sam) ,]$patient_id))>0){
if(patID==unique(cellsannot[which(cellsannot$sample_name %in%sam) ,]$patient_id)){
SamAnnot[paste0(patID,'_',tolower(loc)),]$SamplesID = sam
}}else{message("none")}
}
}else{
if(length(unique(cellsannot[which(cellsannot$sample_name %in%samplesID) ,]$patient_id))>0){
if(patID==unique(cellsannot[which(cellsannot$sample_name %in%samplesID) ,]$patient_id)){
SamAnnot[paste0(patID,'_head_and_tail'),]$SamplesID = samplesID
}}else{message("none")}
}}
}
patID = publishedClinic[i,]$`Donor ID`
patID
samplesID = unlist(str_split(publishedClinic[i,]$`Sequencing Run`,"; "))
samplesID
!all(is.na(samplesID))
length(samplesID)>1
unlist(str_split(j," "))[2]
unlist(str_split(j," "))[1]
length(unique(cellsannot[which(cellsannot$sample_name %in%sam) ,]$patient_id))>0
unique(cellsannot[which(cellsannot$sample_name %in%sam)
)
unique(cellsannot[which(cellsannot$sample_name %in%sam) ,]
)
which(cellsannot$sample_name %in%sam)
cellsannot$sample_name
sam
cellsannot$SamplesNewID = paste0(cellsannot$patient_id,"_",cellsannot$location,"_", cellsannot$sample_name)
unique(cellsannot$SamplesNewID)
cellsannot$SamplesNewID = paste0(cellsannot$patient_id,"_",cellsannot$location,";", cellsannot$sample_name)
unique(cellsannot$SamplesNewID)
SamplesNewID  = subset(cellsannot, !is.na(location)) %>%
unique(paste0(cellsannot$patient_id,"_",cellsannot$location,";", cellsannot$sample_name))
subset(cellsannot, :is.na(location)) %>%
subset(cellsannot, !is.na(location)) %>%
unique(SamplesNewID)
subset(cellsannot, !is.na(location)) %>%
unique(.[,"SamplesNewID"])
cellsannot2 = subset(cellsannot, !is.na(location))
unique(cellsannot2$SamplesNewID)
SamplesNewID = unique(cellsannot2$SamplesNewID)
for (i in SamplesNewID){
patID = unlist(str_split(i," "))[2]
sam = unlist(str_split(i," "))[1]
SamAnnot[patID,]$SamplesID = sam
}
i
for (i in SamplesNewID){
patID = unlist(str_split(i,";"))[2]
sam = unlist(str_split(i,";"))[1]
SamAnnot[patID,]$SamplesID = sam
}
for (i in SamplesNewID){
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
SamAnnot[patID,]$SamplesID = sam
}
View(SamAnnot)
#load clinic and metadata
SamAnnot=getGEO('GSE229413',GSEMatrix=TRUE)[["GSE229413_series_matrix.txt.gz"]]@phenoData@data
SamAnnot$SamplesID = rownames(SamAnnot)
rownames(SamAnnot) = SamAnnot$title
SamAnnot$PatientsID=NA
for (i in unique(cellsannot$patient_id)){
pos=  which(grepl(i,unique(SamAnnot$title)))
if(!is_empty(pos)){
SamAnnot[pos,]$PatientsID = i}
}
summary(SamAnnot$PatientsID %in% unique(cellsannot$patient_id))
unique(cellsannot$patient_id)[!unique(cellsannot$patient_id) %in% SamAnnot$PatientsID]
SamAnnot[SamAnnot$title=="19-227PancNorm","PatientsID"] = "19227"
SamAnnot[SamAnnot$title=="19-732PancNorm","PatientsID"]= "19732"
SamAnnot[SamAnnot$title=="Donor_6_head","PatientsID"]= "Donor_6"
SamAnnot[SamAnnot$title=="Donor_6_tail","PatientsID"]= "Donor_6"
SamAnnot[SamAnnot$title=="DS20191246Tumor","PatientsID"]= "1246"
SamAnnot[SamAnnot$title=="DS20191238Tumor","PatientsID"]= "1238"
SamAnnot[SamAnnot$title=="DS20191229Tumor","PatientsID"]= "1229"
# looking for samplesID from published clinic and cells annotation to paste into samannot
for (i in 1:nrow(publishedClinic)){
patID = publishedClinic[i,]$`Donor ID`
samplesID = unlist(str_split(publishedClinic[i,]$`Sequencing Run`,"; "))
if(!all(is.na(samplesID))){
if(length(samplesID)>1){
for (j in samplesID){
sam = unlist(str_split(j," "))[2]
loc = unlist(str_split(j," "))[1]
if(length(unique(cellsannot[which(cellsannot$sample_name %in%sam) ,]$patient_id))>0){
if(patID==unique(cellsannot[which(cellsannot$sample_name %in%sam) ,]$patient_id)){
SamAnnot[paste0(patID,'_',tolower(loc)),]$SamplesID = sam
}}else{message("none")}
}
}else{
if(length(unique(cellsannot[which(cellsannot$sample_name %in%samplesID) ,]$patient_id))>0){
if(patID==unique(cellsannot[which(cellsannot$sample_name %in%samplesID) ,]$patient_id)){
SamAnnot[paste0(patID,'_head_and_tail'),]$SamplesID = samplesID
}}else{message("none")}
}}
}
cellsannot$SamplesNewID = paste0(cellsannot$patient_id,"_",cellsannot$location,";", cellsannot$sample_name)
cellsannot2 = subset(cellsannot, !is.na(location))
SamplesNewID = unique(cellsannot2$SamplesNewID)
for (i in SamplesNewID){
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
SamAnnot[patID,]$SamplesID = sam
}
summary(unique(cellsannot$sample_name) %in% SamAnnot$SamplesID)
SamplesNewID
cellsannot$SamplesNewID
unique(cellsannot$SamplesNewID)
cellsannot$SamplesNewID2 = paste0(cellsannot$patient_id,"_",cellsannot$lesion,";", cellsannot$sample_name)
unique(cellsannot$SamplesNewID2)
unique(cellsannot$SamplesNewID)
unique(cellsannot$SamplesNewID[!cellsannot$SamplesNewID %in% SamplesNewID])
SamplesNewID2 = unique(cellsannot$SamplesNewID[!cellsannot$SamplesNewID %in% SamplesNewID])
gsub("_NA", "", SamplesNewID2)
SamplesNewID2 = gsub("_NA", "", SamplesNewID2)
i = SamplesNewID2[1]
i
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
patID
sam
SamAnnot[which(SamAnnot$PatientsID==patID),]
SamAnnot[which(SamAnnot$PatientsID==patID),]$SamplesID
for (i in SamplesNewID2){
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
SamAnnot[which(SamAnnot$PatientsID==patID),]$SamplesID = sam
}
patID
which(SamAnnot$PatientsID==patID)
SamAnnot$PatientsID==patID
all(SamAnnot$PatientsID==patID)
for (i in SamplesNewID2){
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
if(!all(SamAnnot$PatientsID==patID)==F){
SamAnnot[which(SamAnnot$PatientsID==patID),]$SamplesID = sam}
}
summary(unique(cellsannot$sample_name) %in% SamAnnot$SamplesID)
unique(paste0(cellsannot$patient_id,"_",cellsannot$location))[unique(paste0(cellsannot$patient_id,"_",cellsannot$location)) %in% unique(SamAnnot$title)]
unique(cellsannot$sample_name) [!unique(cellsannot$sample_name) %in% SamAnnot$SamplesID]
summary(unique(cellsannot$patient_id) %in% SamAnnot$PatientsID)
SamplesNewID2
cellsannot$SamplesNewID2 = paste0(cellsannot$patient_id,"_",cellsannot$lesion,";", cellsannot$sample_name)
cellsannot$SamplesNewID2
cellsannot$SamplesNewID2 = paste0(cellsannot$patient_id,"_",cellsannot$location,";", cellsannot$sample_name)
SamplesNewID2 = unique(cellsannot$SamplesNewID[!cellsannot$SamplesNewID %in% SamplesNewID])
SamplesNewID2 = gsub("_NA", "", SamplesNewID2)
SamplesNewID2
cellsannot$SamplesNewID2 = paste0(cellsannot$patient_id,"_",cellsannot$lesion,";", cellsannot$sample_name)
unique(cellsannot$SamplesNewID2)
summary(unique(cellsannot$patient_id) %in% SamAnnot$PatientsID)
unique(cellsannot$patient_id)
SamplesNewID2
i="1253;129444"
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
patID
sam
!all(SamAnnot$PatientsID==patID)==F
SamAnnot$PatientsID
SamAnnot$PatientsID==patID
all(SamAnnot$PatientsID==patID)==F
all(SamAnnot$PatientsID==patID)
SamAnnot$PatientsID==patID
unique(cellsannot$SamplesNewID[!cellsannot$SamplesNewID %in% SamplesNewID])
SamplesNewID
which(SamAnnot$PatientsID==patID)
for (i in SamplesNewID2){
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
if(!all(SamAnnot$PatientsID==patID)==F){
SamAnnot[which(SamAnnot$PatientsID==patID),]$SamplesID = sam}
}
SamplesNewID2
i= "6750;127260"
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
SamAnnot$PatientsID==patID
i =  "19732;135041"
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
patID
sam
SamAnnot$PatientsID==patID
all(SamAnnot$PatientsID==patID)
all(SamAnnot$PatientsID==patID)==F
!all(SamAnnot$PatientsID==patID)==F
all(SamAnnot$PatientsID==patID)==F
for (i in SamplesNewID2){
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
if(all(SamAnnot$PatientsID==patID)==F){
SamAnnot[which(SamAnnot$PatientsID==patID),]$SamplesID = sam}
}
patID
SamAnnot$PatientsID==patID
all(SamAnnot$PatientsID==patID)
all(SamAnnot$PatientsID==patID)==F
!all(SamAnnot$PatientsID==patID)==F
for (i in SamplesNewID2){
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
if(!all(SamAnnot$PatientsID==patID)==F){
SamAnnot[which(SamAnnot$PatientsID==patID),]$SamplesID = sam}
}
for (i in SamplesNewID2){
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
if(length(which(SamAnnot$PatientsID==patID))==1){
SamAnnot[which(SamAnnot$PatientsID==patID),]$SamplesID = sam}
}
cellsannot$SamplesNewID2 = paste0(cellsannot$patient_id,"_",cellsannot$lesion,";", cellsannot$sample_name)
unique(cellsannot$SamplesNewID2)
summary(unique(cellsannot$patient_id) %in% SamAnnot$PatientsID)
unique(cellsannot$sample_name) [!unique(cellsannot$sample_name) %in% SamAnnot$SamplesID]
View(subset(cellsannot, patient_id=="1261"))
summary(subset(cellsannot, patient_id=="1261")$lesion)
unique(subset(cellsannot, patient_id=="1261")$lesion)
unique(subset(cellsannot, patient_id=="1261")$samples_name)
unique(subset(cellsannot, patient_id=="1261")$sample_name)
list.files(file.path(Rawpath(Metadata),"GSE229413_RAW"))
h5test  = Read10X_h5(file.path(Rawpath(Metadata),"GSE229413_RAW", "GSM7277534_DS20191261TumorKeller_filtered_feature_bc_matrix.h5"))
View(h5test)
dim(h5test)
dim(subset(cellsannot, patient_id=="1261"))
colnames(h5test[,1:5])
h5test  = Read10X_h5(file.path(Rawpath(Metadata),"GSE229413_RAW", "GSM7277533_DS20191261Tumor_filtered_feature_bc_matrix.h5"))
h5test2  = Read10X_h5(file.path(Rawpath(Metadata),"GSE229413_RAW", "GSM7277533_DS20191261Tumor_filtered_feature_bc_matrix.h5"))
h5test  = Read10X_h5(file.path(Rawpath(Metadata),"GSE229413_RAW", "GSM7277534_DS20191261TumorKeller_filtered_feature_bc_matrix.h5"))
dim(h5test)
dim(h5test2)
colnames(h5test2[,1:5])
summary(colnames(h5test) %in% colnames(h5test2))
rownames(subset(cellsannot, patient_id=="1261"))
unlist(lapply(rownames(subset(cellsannot, patient_id=="1261"), str_split("_"),"[[",2)))
unlist(lapply(rownames(subset(cellsannot, patient_id=="1261")), str_split("_"),"[[",2))
unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2))
unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in% colnames(h5test)
summary(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in% colnames(h5test))
summary(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in% colnames(h5test2))
summary(colnames(h5test2) %in%  unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)))
which(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in% colnames(h5test))
subset(cellsannot, patient_id=="1261")[
which(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in% colnames(h5test)),]
summary(as.factor(subset(cellsannot, patient_id=="1261")[
which(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in% colnames(h5test)),]$sample_name))
summary(as.factor(subset(cellsannot, patient_id=="1261")[
which(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in% colnames(h5test2)),]$sample_name))
SamAnnot[PatientsID=="1261",]
SamAnnot[SamAnnot$PatientsID=="1261",]
SamAnnot["DS20191261Tumor" ,]$SamplesID = "130850"
SamAnnot["DS20191261TumorKeller" ,]$SamplesID = "130840"
list.files(file.path(Rawpath(Metadata),"GSE229413_RAW"))
unique(cellsannot$sample_name) [!unique(cellsannot$sample_name) %in% SamAnnot$SamplesID]
unique(SamAnnot$SamplesID) [!unique(SamAnnot$SamplesID) %in% unique(cellsannot$sample_name)]
summary(as.factor(subset(cellsannot, patient_id=="1261")[
which(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in%
colnames(h5test2)),]$sample_name)) # max barcodes in sample 130850  (12 in the other sample)
SamAnnot["DS20191261Tumor" ,]$SamplesID = "130450"
unique(cellsannot$sample_name) [!unique(cellsannot$sample_name) %in% SamAnnot$SamplesID]
unique(SamAnnot$SamplesID) [!unique(SamAnnot$SamplesID) %in% unique(cellsannot$sample_name)]
h5test3  = Read10X_h5(file.path(Rawpath(Metadata),"GSE229413_RAW", "GSM7277528_61354770_Sample_raw_feature_bc_matrix.h5"))
summary(as.factor(subset(cellsannot, patient_id=="1261")[
which(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in%
colnames(h5test3)),]$sample_name))
summary(as.factor(cellsannot[
which(unlist(lapply( str_split(rownames(cellsannot),"_"),"[[",2)) %in%
colnames(h5test3)),]$sample_name))
which.max(summary(as.factor(cellsannot[
which(unlist(lapply( str_split(rownames(cellsannot),"_"),"[[",2)) %in%
colnames(h5test3)),]$sample_name)))
subset(cellsannot, sample_name=="3829")$patient_id
subset(cellsannot, sample_name=="3829-EC")$patient_id
unique(subset(cellsannot, sample_name=="3829-EC")$patient_id)
summary(as.factor(cellsannot[
which(unlist(lapply( str_split(rownames(cellsannot),"_"),"[[",2)) %in%
colnames(h5test3)),]$sample_name))
dim(h5test3)
list.files(file.path(Rawpath(Metadata),"GSE229413_RAW"))
h5test3  = Read10X_h5(file.path(Rawpath(Metadata),"GSE229413_RAW", "GSM7277528_61354770_Sample_filtered_feature_bc_matrix.h5"))
summary(as.factor(cellsannot[
which(unlist(lapply( str_split(rownames(cellsannot),"_"),"[[",2)) %in%
colnames(h5test3)),]$sample_name))
unique(subset(cellsannot, sample_name=="126197")$patient_id)
unique(SamAnnot$SamplesID) [!unique(SamAnnot$SamplesID) %in% unique(cellsannot$sample_name)] #two sampels diff: donor_6 in geoMX only
h5test4  = Read10X_h5(file.path(Rawpath(Metadata),"GSE229413_RAW", "GSM7277529_61354830_Tissue_filtered_feature_bc_matrix.h5"))
h5test5  = Read10X_h5(file.path(Rawpath(Metadata),"GSE229413_RAW", "GSM7277530_61356750_Tumor_filtered_feature_bc_matrix.h5"))
summary(as.factor(cellsannot[
which(unlist(lapply( str_split(rownames(cellsannot),"_"),"[[",2)) %in%
colnames(h5test4)),]$sample_name))
summary(as.factor(cellsannot[
which(unlist(lapply( str_split(rownames(cellsannot),"_"),"[[",2)) %in%
colnames(h5test5)),]$sample_name))
unique(subset(cellsannot, sample_name=="123798")$patient_id) # pat ID = 4770
unique(subset(cellsannot, sample_name=="127260")$patient_id) # pat ID = 4770
#load clinic and metadata
SamAnnot=getGEO('GSE229413',GSEMatrix=TRUE)[["GSE229413_series_matrix.txt.gz"]]@phenoData@data
SamAnnot$SamplesID = rownames(SamAnnot)
rownames(SamAnnot) = SamAnnot$title
unique(SamAnnot$title)
unique(cellsannot$patient_id)
SamAnnot$PatientsID=NA
for (i in unique(cellsannot$patient_id)){
pos=  which(grepl(i,unique(SamAnnot$title)))
if(!is_empty(pos)){
SamAnnot[pos,]$PatientsID = i}
}
summary(SamAnnot$PatientsID %in% unique(cellsannot$patient_id))
unique(cellsannot$patient_id)[!unique(cellsannot$patient_id) %in% SamAnnot$PatientsID]
SamAnnot[SamAnnot$title=="19-227PancNorm","PatientsID"] = "19227"
SamAnnot[SamAnnot$title=="19-732PancNorm","PatientsID"]= "19732"
SamAnnot[SamAnnot$title=="Donor_6_head","PatientsID"]= "Donor_6"
SamAnnot[SamAnnot$title=="Donor_6_tail","PatientsID"]= "Donor_6"
# looking for samplesID from published clinic and cells annotation to paste into samannot
for (i in 1:nrow(publishedClinic)){
patID = publishedClinic[i,]$`Donor ID`
samplesID = unlist(str_split(publishedClinic[i,]$`Sequencing Run`,"; "))
if(!all(is.na(samplesID))){
if(length(samplesID)>1){
for (j in samplesID){
sam = unlist(str_split(j," "))[2]
loc = unlist(str_split(j," "))[1]
if(length(unique(cellsannot[which(cellsannot$sample_name %in%sam) ,]$patient_id))>0){
if(patID==unique(cellsannot[which(cellsannot$sample_name %in%sam) ,]$patient_id)){
SamAnnot[paste0(patID,'_',tolower(loc)),]$SamplesID = sam
}}else{message("none")}
}
}else{
if(length(unique(cellsannot[which(cellsannot$sample_name %in%samplesID) ,]$patient_id))>0){
if(patID==unique(cellsannot[which(cellsannot$sample_name %in%samplesID) ,]$patient_id)){
SamAnnot[paste0(patID,'_head_and_tail'),]$SamplesID = samplesID
}}else{message("none")}
}}
}
cellsannot$SamplesNewID = paste0(cellsannot$patient_id,"_",cellsannot$location,";", cellsannot$sample_name)
cellsannot2 = subset(cellsannot, !is.na(location))
SamplesNewID = unique(cellsannot2$SamplesNewID)
for (i in SamplesNewID){
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
SamAnnot[patID,]$SamplesID = sam
}
SamplesNewID2 = unique(cellsannot$SamplesNewID[!cellsannot$SamplesNewID %in% SamplesNewID])
SamplesNewID2 = gsub("_NA", "", SamplesNewID2)
for (i in SamplesNewID2){
patID = unlist(str_split(i,";"))[1]
sam = unlist(str_split(i,";"))[2]
if(length(which(SamAnnot$PatientsID==patID))==1){
SamAnnot[which(SamAnnot$PatientsID==patID),]$SamplesID = sam}
}
cellsannot$SamplesNewID2 = paste0(cellsannot$patient_id,"_",cellsannot$lesion,";", cellsannot$sample_name)
unique(cellsannot$SamplesNewID2)
summary(unique(cellsannot$patient_id) %in% SamAnnot$PatientsID)
unique(cellsannot$sample_name) [!unique(cellsannot$sample_name) %in% SamAnnot$SamplesID]
summary(as.factor(subset(cellsannot, patient_id=="1261")[
which(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in%
olnames(h5test)),]$sample_name)) # max barcodes in sample 130840 (16 in the other sample)
summary(as.factor(subset(cellsannot, patient_id=="1261")[
which(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in%
olnames(h5test)),]$sample_name)) # max barcodes in sample 130840 (16 in the other sample)
summary(as.factor(subset(cellsannot, patient_id=="1261")[
which(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in%
colnames(h5test)),]$sample_name)) # max barcodes in sample 130840 (16 in the other sample)
summary(as.factor(subset(cellsannot, patient_id=="1261")[
which(unlist(lapply( str_split(rownames(subset(cellsannot, patient_id=="1261")),"_"),"[[",2)) %in%
colnames(h5test2)),]$sample_name)) # max barcodes in sample 130850  (12 in the other sample)
SamAnnot["DS20191261Tumor" ,]$SamplesID = "130450"
SamAnnot["DS20191261TumorKeller" ,]$SamplesID = "130840"
unique(cellsannot$sample_name) [!unique(cellsannot$sample_name) %in% SamAnnot$SamplesID] #three samples to go "126197" "123798" "127260"
unique(SamAnnot$SamplesID) [!unique(SamAnnot$SamplesID) %in% unique(cellsannot$sample_name)] #two sampels diff: donor_6 in geoMX only
summary(as.factor(cellsannot[
which(unlist(lapply( str_split(rownames(cellsannot),"_"),"[[",2)) %in%
colnames(h5test5)),]$sample_name))
unique(subset(cellsannot, sample_name=="126197")$patient_id) # pat ID = 4770
unique(subset(cellsannot, sample_name=="123798")$patient_id) # pat ID = 4770
unique(subset(cellsannot, sample_name=="127260")$patient_id) # pat ID = 4770
unique(SamAnnot$SamplesID) [!unique(SamAnnot$SamplesID) %in% unique(cellsannot$sample_name)] #two sampels diff: donor_6 in geoMX only
list.files(file.path(Rawpath(Metadata),"GSE229413_RAW"))
SamAnnot[SamAnnot$title=="DS20191246Tumor","PatientsID"]= "4770"
SamAnnot[SamAnnot$title=="DS20191238Tumor","PatientsID"]= "4830"
SamAnnot[SamAnnot$title=="DS20191229Tumor","PatientsID"]= "6750"
unique(cellsannot$sample_name) [!unique(cellsannot$sample_name) %in% SamAnnot$SamplesID]
SamAnnot[SamAnnot$title=="DS20191246Tumor","PatientsID"]= "4770"
SamAnnot[SamAnnot$title=="DS20191246Tumor","SamplesID"]= "126197"
SamAnnot[SamAnnot$title=="DS20191238Tumor","PatientsID"]= "4830"
SamAnnot[SamAnnot$title=="DS20191246Tumor","SamplesID"]= "123798"
SamAnnot[SamAnnot$title=="DS20191229Tumor","PatientsID"]= "6750"
SamAnnot[SamAnnot$title=="DS20191246Tumor","SamplesID"]= "127260"
unique(cellsannot$sample_name) [!unique(cellsannot$sample_name) %in% SamAnnot$SamplesID]
SamAnnot[SamAnnot$title=="DS20191246Tumor","SamplesID"]
SamAnnot[SamAnnot$title=="DS20191246Tumor","PatientsID"]= "4770"
SamAnnot[SamAnnot$title=="DS20191246Tumor","SamplesID"]= "126197"
SamAnnot[SamAnnot$title=="DS20191238Tumor","PatientsID"]= "4830"
SamAnnot[SamAnnot$title=="DS20191238Tumor","SamplesID"]= "123798"
SamAnnot[SamAnnot$title=="DS20191229Tumor","PatientsID"]= "6750"
SamAnnot[SamAnnot$title=="DS20191229Tumor","SamplesID"]= "127260"
unique(cellsannot$sample_name) [!unique(cellsannot$sample_name) %in% SamAnnot$SamplesID]
cellsannot = cellsannot[colnames(count),]
# Creating MetaObject to clean
Metadata <- CreateDataset(project,path) %>%
AddClinicFromObject(object = publishedClinic,
Export = F,
setSamplesID.Column = NULL,
setPatientID.Column = "Donor ID",
name ="rawClinic" ,
type ="Patients") %>%
AddClinicFromObject(object = SamAnnot,
Export = F,
setSamplesID.Column = "SamplesID",
setPatientID.Column = "PatientsID",
name ="RawSamAnnot" ,
type ="Samples") %>%
AddClinicFromObject(object = cellsannot,
Export = F,
setSamplesID.Column = "sample_name",
setCellsBarcode.Column = "barcodes",
setPatientID.Column = "patient_id",
name ="RawCellsAnnot",
type ="Cells") %>%
AddExpressionMatrixSC(
ExpressionMatrix = count,
name = "rawcount")
CheckMeta(Metadata)
